| **Vulnerability**           | CVE-2024-37404                                                                                   |
|-----------------------------|--------------------------------------------------------------------------------------------------|
| **Description**             | CVE-2024-37404 is a critical vulnerability in Ivanti Connect Secure (ICS) and Ivanti Policy Secure (IPS) that allows authenticated administrators to execute arbitrary code with root privileges. The flaw arises from a CRLF (Carriage Return Line Feed) injection in the OpenSSL configuration during Certificate Signing Request (CSR) generation, enabling attackers to inject malicious directives into the configuration file. ([AmberWolf Research](https://blog.amberwolf.com/blog/2024/october/cve-2024-37404-ivanti-connect-secure-authenticated-rce-via-openssl-crlf-injection/)) |
| **Affected Systems**        | - Ivanti Connect Secure versions prior to 22.7R2.1 and 22.7R2.2 <br> - Ivanti Policy Secure versions prior to 22.7R1.1 |
| **Attack Vector**           | Remote: An attacker with administrative access to the web application can exploit this vulnerability by injecting malicious input during the CSR generation process, leading to remote code execution with root privileges. |
| **Exploitation Techniques** | - **CRLF Injection in CSR Generation**: The attacker leverages the lack of input validation in the CSR generation process to inject CRLF sequences into fields such as `localityName`. This injection allows the addition of new sections or directives in the OpenSSL configuration file. <br> - **Specifying Malicious OpenSSL Engine**: By injecting a new engine section pointing to a malicious shared library (e.g., `/tmp/malicious.so`), the attacker manipulates OpenSSL to load and execute arbitrary code during the CSR generation. <br> - **Execution of Arbitrary Code with Root Privileges**: Once the malicious engine is loaded by OpenSSL, the attacker's code executes with root privileges, compromising the underlying system. ([AmberWolf Research](https://blog.amberwolf.com/blog/2024/october/cve-2024-37404-ivanti-connect-secure-authenticated-rce-via-openssl-crlf-injection/)) |
| **Proof of Concept (PoC)**  | A proof of concept involves: <br> 1. **Accessing CSR Generation Interface**: The attacker navigates to the CSR generation page at `/dana-admin/cert/admincertnewcsr.cgi`. <br> 2. **Injecting Malicious Input**: In the `localityName` field, the attacker inputs a value containing a CRLF sequence followed by a new engine section specifying a path to a malicious shared library. <br> 3. **Triggering CSR Generation**: Submitting the form causes the application to generate a configuration file with the injected directives. <br> 4. **OpenSSL Execution**: The system calls OpenSSL with the crafted configuration, leading to the loading and execution of the malicious engine, resulting in code execution with root privileges. ([AmberWolf Research](https://blog.amberwolf.com/blog/2024/october/cve-2024-37404-ivanti-connect-secure-authenticated-rce-via-openssl-crlf-injection/)) |
| **The Impact of the Bug**   | - Unauthorized execution of arbitrary code with root privileges. <br> - Full system compromise, allowing attackers to manipulate system operations, access sensitive data, or deploy further malware. <br> - Elevated risk due to the potential for exploitation by attackers who have obtained administrative credentials through other means. |
| **How to Detect Infections**| - **Log Analysis**: Examine server logs for unusual CSR generation activities, especially those with unexpected or malformed input in fields like `localityName`. <br> - **File Integrity Monitoring**: Monitor critical system files and directories for unauthorized modifications that may indicate the presence of malicious shared libraries or altered configurations. <br> - **Process Monitoring**: Observe running processes for instances of OpenSSL loading unexpected engine modules, which could signify exploitation attempts. |
| **Mitigation Steps**        | - **Update Ivanti Products**: Upgrade to Ivanti Connect Secure version 22.7R2.1 or 22.7R2.2, and Ivanti Policy Secure version 22.7R1.1, where this vulnerability is addressed. <br> - **Restrict Administrative Access**: Limit administrative interface exposure to trusted networks to reduce the risk of exploitation. <br> - **Input Validation**: Implement strict input validation to prevent injection of malicious characters or sequences in user-supplied data during CSR generation. |
| **References**              | - [AmberWolf Research - CVE-2024-37404](https://blog.amberwolf.com/blog/2024/october/cve-2024-37404-ivanti-connect-secure-authenticated-rce-via-openssl-crlf-injection/) <br> - [Ivanti Security Advisory - CVE-2024-37404](https://forums.ivanti.com/s/article/Security-Advisory-Ivanti-Connect-Secure-and-Policy-Secure-CVE-2024-37404) <br> - [Ivanti Blog - October 2024 Security Update](https://www.ivanti.com/blog/october-2024-security-update) |
