| **Vulnerability**         | CVE-2024-23113 & CVE-2024-47575 |
|---------------------------|------------------------------------|
| **Type**                  | Privilege Escalation and Remote Code Execution |
| **Description**           | These vulnerabilities affect Fortinet FortiManager, a centralized management tool for FortiGate appliances. CVE-2024-23113 allows privilege escalation by exploiting weak session management and permission validation flaws. CVE-2024-47575 facilitates remote code execution via FGFM (FortiGate-to-FortiManager) protocol, which lacks sufficient security controls, enabling attackers to manipulate authenticated FortiGate devices to control FortiManager instances. These flaws are actively exploited in the wild. |
| **Affected Systems**      | Fortinet FortiManager (versions prior to patched releases) and FortiGate appliances using FGFM for central management. |
| **Attack Vector**         | Remote: Attackers exploit FGFM protocol weaknesses and session handling vulnerabilities to gain unauthorized access and execute arbitrary commands. Exploitation involves crafting malicious packets or leveraging authenticated FortiGate devices. |
| **Exploit Mechanics**     | **CVE-2024-23113 (Privilege Escalation)** <br> - Exploits weak session handling in FortiManager. <br> - Attackers manipulate session tokens or bypass permission checks to gain administrative privileges. <br> - Includes session hijacking or unauthorized admin account creation. <br><br> **CVE-2024-47575 (Remote Code Execution)** <br> - Leverages FGFM (FortiGate-to-FortiManager) protocol over TCP port 541. <br> - Attackers register malicious or compromised FortiGate devices. <br> - Injects payloads via insufficient validation in communication, allowing arbitrary command execution. <br> - Debugging features in FortiGate appliances expose protocol details, aiding exploitation. |
| **The Impact of the Bug** | - Privilege escalation allows attackers to gain administrative control over FortiManager instances. <br> - Remote code execution risks complete system compromise, impacting all managed FortiGate devices and potentially the entire network infrastructure. |
| **Detection Techniques** | **Log Analysis** <br> - Monitor FortiManager logs for: <br> &nbsp;&nbsp;&nbsp;- Unexpected device registrations. <br> &nbsp;&nbsp;&nbsp;- Unusual administrative actions or session escalations. <br> &nbsp;&nbsp;&nbsp;- Commands/actions initiated by unknown session tokens. <br><br> **Network Traffic Inspection** <br> - Analyze TCP port 541 traffic for: <br> &nbsp;&nbsp;&nbsp;- Malformed FGFM packets. <br> &nbsp;&nbsp;&nbsp;- Suspicious or large payloads. <br> &nbsp;&nbsp;&nbsp;- Irregular communication patterns. <br><br> **File Integrity Monitoring** <br> - Monitor critical FortiManager system files for unexpected changes. <br><br> **Behavioral Detection** <br> - Deploy EDR tools to monitor unusual behaviors: <br> &nbsp;&nbsp;&nbsp;- High-frequency administrative actions. <br> &nbsp;&nbsp;&nbsp;- Unauthorized command executions linked to debugging features. <br><br> **IoC Correlation** <br> - Compare logs and traffic against known IoCs from security advisories. <br><br> **FortiManager Audits** <br> - Audit registered devices regularly to ensure only legitimate devices are authorized. <br> - Validate session logs for anomalies (e.g., frequent invalid tokens). |
| **How to detect infections** | - **Log Analysis**: Monitor FortiManager logs for unauthorized device registrations or anomalous commands. <br> - **Protocol Monitoring**: Inspect traffic on TCP port 541 for unexpected FGFM messages or packet patterns. <br> - **Endpoint Detection**: Use EDR tools to identify unauthorized modifications in FortiManager or its configurations. |
| **Mitigation Steps**       | - Apply the latest patches released by Fortinet to address these vulnerabilities. <br> - Restrict access to FortiManager and FortiGate appliances by implementing strict network segmentation and access control. <br> - Regularly audit registered devices and session logs for anomalies. <br> - Disable or limit debugging functionalities in production environments to reduce exposure. |
| **Workarounds**            | - Isolate FortiManager instances from the internet and allow access only through a secure VPN. <br> - Temporarily disable FGFM protocol communications if not immediately required for operations. |
| **References**             | - [WatchTowr Blog - Hop-Skip-FortiJump-FortiJump-Higher](https://labs.watchtowr.com/hop-skip-fortijump-fortijumphigher-cve-2024-23113-cve-2024-47575/) |
