| Vulnerability | CVE-2025-29927 |
|---------------|----------------|
| **Vulnerability** | **CVE-2025-29927** |
| **Description** | CVE-2025-29927 is a critical authorization bypass vulnerability in the Next.js framework.<br>The flaw arises from improper validation of the internal-use HTTP header `x-middleware-subrequest`.<br>By injecting this header into HTTP requests, attackers can trick middleware into treating the request as internal, allowing them to bypass authentication and access protected resources without logging in. |
| **Affected Systems** | The following versions of Next.js are vulnerable:<br><br>- Next.js 11: 11.1.4 and later<br>- Next.js 12: All versions prior to 12.3.5<br>- Next.js 13: All versions prior to 13.5.9<br>- Next.js 14: All versions prior to 14.2.25<br>- Next.js 15: All versions prior to 15.2.3 |
| **Attack Vector** | To exploit this vulnerability:<br><br>- The application must use middleware for access control or authentication.<br>- Middleware logic must not validate or sanitize the `x-middleware-subrequest` header.<br>- An attacker forges this header in a crafted HTTP request to a protected route.<br>- Middleware treats the request as trusted/internal and skips access control. |
| **Exploitation Techniques** | - Header Injection: Injecting the `x-middleware-subrequest` header into HTTP requests.<br>- Middleware Trust Abuse: Exploiting misconfigured or overly permissive trust logic in middleware.<br>- JavaScript Reconnaissance: Inspecting client-side code to discover sensitive endpoints like `/events/create`.<br>- Automated Mass Testing: Using tools like Shodan, Nuclei, or Fofa to identify and scan targets. |
| **Proof of Concept (PoC)** | 1. Version Discovery<br>```bash<br>nuclei -t nuclei-templates/http/cves/2025/CVE-2025-29927.yaml<br>```<br><br>2. Exploiting the Bypass with Curl<br>```bash<br>curl -H "x-middleware-subrequest: middleware:middleware:middleware" https://target.com/dashboard<br>```<br><br>3. Exploiting with Burp Suite<br>- Intercept a request to a protected route (e.g., /events)<br>- Add the header:<br> `x-middleware-subrequest: middleware`<br>- Forward the request and observe access without a...
| **The Impact of the Bug** | - Unauthorized access to protected resources without valid authentication.<br>- Potential privilege escalation, including access to admin-level features.<br>- Application takeover through exposed internal or sensitive endpoints.<br>- Breach of tenant isolation in multi-tenant applications.<br>- Exploitation of middleware logic flaws for full session bypass. |
| **How to Detect Infections** | - Log Analysis: Monitor access logs for external requests containing the x-middleware-subrequest header.<br>- Middleware Flow Audit: Ensure access control is not skipped based on request headers.<br>- Session Validation: Check for missing or invalid session tokens where access was granted.<br>- Endpoint Recon Detection: Review logs for access to hidden or non-linked routes like /events/create. |
| **Mitigation Steps** | - Upgrade to a patched version of Next.js:<br>  - 12.3.5 or later<br>  - 13.5.9 or later<br>  - 14.2.25 or later<br>  - 15.2.3 or later<br><br>- Block or sanitize the header in middleware:<br>```js<br>if (request.headers.get("x-middleware-subrequest")) {<br>  return new Response("Blocked", { status: 403 });<br>}<br>```<br><br>- Harden Middleware Logic:<br>  - Explicitly validate sessions and roles on the server.<br>  - Do not rely on header presence for access control decisions.<br...
| **Workarounds** | - Strip or reject the x-middleware-subrequest header from external client requests.<br>- Restrict access to privileged routes by IP, VPN, or auth tokens.<br>- Monitor real-time access to high-risk endpoints and alert on anomalies. |
| **References** | - https://vercel.com/blog/postmortem-on-next-js-middleware-bypass<br>- https://jfrog.com/blog/cve-2025-29927-next-js-authorization-bypass/<br>- https://censys.com/advisory/cve-2025-29927 |
