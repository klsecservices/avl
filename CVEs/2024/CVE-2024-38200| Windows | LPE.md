| **Vulnerability**           | CVE-2024-38200                                                                                   |
|-----------------------------|---------------------------------------------------------------------------------------------------|
| **Description**             | CVE-2024-38200 is a spoofing vulnerability in Microsoft Office that allows attackers to capture NTLMv2 hashes by exploiting Office URI schemes. This flaw enables malicious actors to craft links that, when accessed, can lead to unauthorized disclosure of sensitive authentication information. ([nvd.nist.gov](https://nvd.nist.gov/vuln/detail/cve-2024-38200)) |
| **Affected Systems**        | Microsoft Office versions, including Office 2019 and Microsoft 365, are susceptible to this vulnerability. ([github.com](https://github.com/passtheticket/CVE-2024-38200)) |
| **Attack Vector**           | Remote: Attackers can deliver malicious links via phishing emails or compromised websites. When a user clicks on such a link, it triggers the Office application to access a remote file, leading to the capture of NTLMv2 hashes without user prompts or warnings. |
| **Exploitation Techniques** | - **Abuse of Office URI Schemes**: Attackers craft a malicious link using the `ms-word:ofe|u|http://` or similar URI schemes supported by Office applications. These links point to remote documents hosted on attacker-controlled servers. <br> - **Automatic Authentication via NTLM**: When the victim interacts with the malicious link, Office attempts to open the remote file. If the file is hosted on a server that requests authentication, the victimâ€™s system automatically sends NTLMv2 hashes for authentication without user interaction. <br> - **HTTP-to-UNC Redirection**: By setting up an HTTP server with a `302 Redirect` to an SMB (UNC) path, attackers can force Office to authenticate over SMB, enabling easier capture of NTLMv2 hashes using tools like Responder or Inveigh. <br> - **Relay Attacks**: The captured NTLMv2 hashes can be used in NTLM relay attacks to impersonate the victim and gain unauthorized access to network resources or services. <br> - **Advanced Delivery Mechanisms**: Phishing emails or document-based attacks (e.g., malicious macros or embedded links) can be used to trick users into interacting with these crafted links. |
| **The Impact of the Bug**   | - Unauthorized disclosure of NTLMv2 hashes, potentially leading to credential theft. <br> - Increased risk of NTLM relay attacks, which can compromise critical systems or services. <br> - Potential lateral movement and privilege escalation in enterprise environments, threatening data confidentiality, integrity, and availability. |
| **How to Detect Infections**| - **Network Traffic Monitoring**: Look for unusual outbound traffic from Office applications to external servers, especially over HTTP or SMB. <br> - **Authentication Anomalies**: Monitor authentication logs for repeated or unexpected NTLM authentication attempts to external IP addresses. <br> - **Honeypots**: Deploy NTLM traps to detect unauthorized attempts to capture NTLM hashes within the network. |
| **Mitigation Steps**        | - Apply security patches provided by Microsoft addressing CVE-2024-38200. <br> - Educate users about the risks of clicking on unsolicited links or opening documents from untrusted sources. <br> - Configure network security controls to block unauthorized outbound SMB traffic and restrict NTLM authentication to trusted systems only. <br> - Use Group Policy settings to disable NTLM authentication where feasible and enforce Kerberos authentication. |
| **Workarounds**             | - Disable automatic URL handling in Office applications to prevent automatic access to remote resources. <br> - Implement network-level protections to intercept and block malicious Office URI schemes. <br> - Use host-based firewalls or EDR solutions to block unauthorized Office application behaviors. |
| **References**              | - [Microsoft Security Response Center - CVE-2024-38200](https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-38200) <br> - [GitHub Repository - CVE-2024-38200](https://github.com/passtheticket/CVE-2024-38200) |
